# Contributor Guide

This repository is maintained using [projen](https://github.com/projen/projen).

## Local workflow

1. Use **Node.js 22 LTS**. If you use `nvm`, activate it with `nvm use 22`.
2. Install `ts-node`.
3. Install dependencies with `npm install` once after cloning. This creates
   the `node_modules` directory so local `projen` and `jest` are available.
   After installation `npm test` should run without prompts.
4. Run `npx projen` whenever you modified `.projenrc.ts` **or** after
   installing dependencies. This regenerates project files and prevents the CI
   job from reporting that files changed during build.
   If `npm run build` reports modified files, run `npx projen` again and commit
   the regenerated outputs.
5. Format all TypeScript and JSON files with `npx prettier --write`.
6. Lint with `npm run eslint` then run `npm test`.
   If tests do not start, ensure dependencies were installed and Node 22 is active.
   If Jest runs out of memory, prepend `NODE_OPTIONS=--max_old_space_size=4096`.
7. Build the project using `npm run build`.
   The same `NODE_OPTIONS` flag can be used when memory errors occur.
8. Commit changes using short presentâ€‘tense messages.

## Pull Requests

Pull request titles must follow the pattern `type[scope]: description`.
Allowed types are `feat`, `fix`, `chore`, `docs`, `refactor`, `test`, `build`,
`ci`, `perf`, and `codex` for automated updates. Use a short scope such as
`runner` or `docs` to clarify the area affected. Codex should use the `codex`
type so it is visible that the PR was generated by an AI. Commit messages must
use the same format. Include `Fixes #` with the related issue in the body and
fill out the summary and testing sections of the template.

## CI

GitHub workflows execute `npx projen build` which performs linting, testing and compilation. Ensure the local steps above succeed before pushing.

## Documentation

Public API docs are generated with `npm run docgen`. Update them whenever exports change.

### Dynamic scaling

The `RunnerScaler` construct controls the Auto Scaling Group size based on the GitLab job queue. If you change the scaling logic or add new scaling constructs:

1. Update `README.md` with usage examples.
2. Regenerate the API docs with `npm run docgen`.
3. Run the tests and build steps before committing.
